<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fashion Agent Chat</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .chat-container {
            width: 95%;
            max-width: 1200px;
            height: 85vh;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-header {
            background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .chat-header h1 {
            font-size: 24px;
            font-weight: 600;
        }

        .chat-header p {
            font-size: 14px;
            opacity: 0.9;
            margin-top: 5px;
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: #f8f9fa;
        }

        .message {
            margin-bottom: 20px;
            display: flex;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.user {
            justify-content: flex-end;
        }

        .message.bot {
            justify-content: flex-start;
        }

        .message-bubble {
            max-width: 70%;
            padding: 12px 18px;
            border-radius: 18px;
            font-size: 14px;
            line-height: 1.4;
            word-wrap: break-word;
        }

        .message.user .message-bubble {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .message.bot .message-bubble {
            background: white;
            color: #333;
            border: 1px solid #e0e0e0;
        }

        /* Outfit recommendations styling */
        .outfit-response {
            max-width: 90%;
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .style-summary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .style-summary h3 {
            margin-bottom: 8px;
            font-size: 18px;
        }

        .outfit-metrics {
            display: flex;
            justify-content: space-between;
            background: #f8f9fa;
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 12px;
        }

        .metric {
            text-align: center;
        }

        .metric-value {
            font-weight: bold;
            color: #667eea;
            font-size: 14px;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .product-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
            text-decoration: none;
            color: inherit;
            display: block;
        }

        .product-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            text-decoration: none;
            color: inherit;
        }

        .product-link {
            display: block;
            text-decoration: none;
            color: inherit;
        }

        .product-link:hover {
            text-decoration: none;
            color: inherit;
        }

        .product-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: #999;
        }

        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .product-info {
            padding: 15px;
        }

        .product-name {
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 5px;
            color: #333;
        }

        .product-category {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .product-price {
            font-size: 16px;
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 8px;
        }

        .product-description {
            font-size: 12px;
            color: #666;
            line-height: 1.4;
            margin-bottom: 8px;
        }

        .why-chosen {
            font-size: 11px;
            color: #667eea;
            font-style: italic;
            background: #f8f9ff;
            padding: 6px;
            border-radius: 4px;
        }

        .styling-tips {
            background: #fff9e6;
            border-left: 4px solid #ffcc02;
            padding: 15px;
            border-radius: 0 8px 8px 0;
            margin-top: 15px;
        }

        .styling-tips h4 {
            color: #b8860b;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .styling-tips p {
            font-size: 13px;
            line-height: 1.5;
            color: #666;
        }

        .chat-input-container {
            padding: 20px;
            background: white;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            padding: 12px 18px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.3s;
        }

        .chat-input:focus {
            border-color: #667eea;
        }

        .send-button {
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .send-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        .send-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .typing-indicator {
            display: none;
            align-items: center;
            gap: 10px;
            padding: 12px 18px;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 18px;
            max-width: 70%;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: #999;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-10px);
            }
        }

        .error-message {
            color: #ff6b6b;
            font-size: 12px;
            text-align: center;
            margin-top: 10px;
        }

        .loading-placeholder {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 2s infinite;
            border-radius: 4px;
            height: 20px;
            margin: 5px 0;
        }

        @keyframes loading {
            0% {
                background-position: 200% 0;
            }
            100% {
                background-position: -200% 0;
            }
        }

        /* Scrollbar styling */
        .chat-messages::-webkit-scrollbar {
            width: 6px;
        }

        .chat-messages::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 10px;
        }

        .chat-messages::-webkit-scrollbar-thumb:hover {
            background: #a1a1a1;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .chat-container {
                width: 100%;
                height: 100vh;
                border-radius: 0;
            }

            .products-grid {
                grid-template-columns: 1fr;
            }

            .outfit-metrics {
                flex-direction: column;
                gap: 8px;
            }

            .outfit-response {
                max-width: 95%;
            }
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <h1>Fashion Agent</h1>
                            <p>Your personal style consultant</p>
        </div>
        
        <div class="chat-messages" id="chatMessages">
            <div class="message bot">
                <div class="message-bubble">
                    Hello! I'm your fashion agent powered by advanced AI and style analysis. Tell me what kind of outfit you're looking for (including your budget if you have one), and I'll create the perfect style recommendation for you! 
                    <br><br>
                    Try something like: "I need a casual chic outfit for a date night under $200" or "Professional business attire for important meetings"
                </div>
            </div>
        </div>
        
        <div class="chat-input-container">
            <input type="text" id="chatInput" class="chat-input" placeholder="Describe your style needs and budget..." autocomplete="off">
            <button id="sendButton" class="send-button">Send</button>
        </div>
    </div>

    <script>
        const chatMessages = document.getElementById('chatMessages');
        const chatInput = document.getElementById('chatInput');
        const sendButton = document.getElementById('sendButton');

        function addMessage(content, isUser = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'bot'}`;
            
            const bubbleDiv = document.createElement('div');
            bubbleDiv.className = 'message-bubble';
            bubbleDiv.innerHTML = content;
            
            messageDiv.appendChild(bubbleDiv);
            chatMessages.appendChild(messageDiv);
            
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function addOutfitRecommendation(data) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot';
            
            const outfitDiv = document.createElement('div');
            outfitDiv.className = 'outfit-response';
            
            // Style summary
            if (data.recommendations.style_summary) {
                const summaryDiv = document.createElement('div');
                summaryDiv.className = 'style-summary';
                summaryDiv.innerHTML = `
                    <h3>âœ¨ Your Perfect Style</h3>
                    <p>${data.recommendations.style_summary}</p>
                `;
                outfitDiv.appendChild(summaryDiv);
            }

            // Outfit metrics
            if (data.recommendations.outfit_metrics) {
                const metricsDiv = document.createElement('div');
                metricsDiv.className = 'outfit-metrics';
                const metrics = data.recommendations.outfit_metrics;
                metricsDiv.innerHTML = `
                    <div class="metric">
                        <div class="metric-value">${metrics.total_price}</div>
                        <div>Total Price</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value">${metrics.item_count}</div>
                        <div>Items</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value">${metrics.images_loaded}</div>
                        <div>Images</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value">${metrics.average_price}</div>
                        <div>Avg Price</div>
                    </div>
                `;
                outfitDiv.appendChild(metricsDiv);
            }

            // Products grid
            if (data.recommendations.products && data.recommendations.products.length > 0) {
                const productsGrid = document.createElement('div');
                productsGrid.className = 'products-grid';
                
                data.recommendations.products.forEach(product => {
                    // Create clickable product card
                    const productCard = document.createElement('div');
                    productCard.className = 'product-card';
                    
                    // Make the card clickable if URL is available
                    if (product.url) {
                        productCard.style.cursor = 'pointer';
                        productCard.addEventListener('click', () => {
                            window.open(product.url, '_blank');
                        });
                        productCard.title = 'Click to view on Zara website';
                    }
                    
                    // Image section
                    const imageDiv = document.createElement('div');
                    imageDiv.className = 'product-image';
                    
                    if (product.cached_image_path && product.image_available) {
                        const img = document.createElement('img');
                        img.src = product.cached_image_path;
                        img.alt = product.name;
                        img.onerror = function() {
                            this.parentElement.innerHTML = 'ðŸ“· Image not available';
                        };
                        imageDiv.appendChild(img);
                    } else {
                        imageDiv.innerHTML = 'ðŸ“· Loading image...';
                    }
                    
                    // Product info
                    const infoDiv = document.createElement('div');
                    infoDiv.className = 'product-info';
                    infoDiv.innerHTML = `
                        <div class="product-category">${product.category}</div>
                        <div class="product-name">${product.name}</div>
                        <div class="product-price">${product.price}</div>
                        <div class="product-description">${product.description || ''}</div>
                        ${product.why_chosen ? `<div class="why-chosen">ðŸ’¡ ${product.why_chosen}</div>` : ''}
                        ${product.url ? '<div class="click-hint" style="font-size: 11px; color: #667eea; margin-top: 8px; text-align: center;">ðŸ”— Click to view on Zara</div>' : ''}
                    `;
                    
                    productCard.appendChild(imageDiv);
                    productCard.appendChild(infoDiv);
                    productsGrid.appendChild(productCard);
                });
                
                outfitDiv.appendChild(productsGrid);
            }

            // Styling tips
            if (data.recommendations.styling_tips) {
                const tipsDiv = document.createElement('div');
                tipsDiv.className = 'styling-tips';
                tipsDiv.innerHTML = `
                    <h4>ðŸ‘— Styling Tips</h4>
                    <p>${data.recommendations.styling_tips}</p>
                `;
                outfitDiv.appendChild(tipsDiv);
            }
            
            messageDiv.appendChild(outfitDiv);
            chatMessages.appendChild(messageDiv);
            
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function showTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message bot';
            typingDiv.id = 'typingIndicator';
            
            const typingBubble = document.createElement('div');
            typingBubble.className = 'typing-indicator';
            typingBubble.style.display = 'flex';
            typingBubble.style.justifyContent = 'center';
            typingBubble.style.alignItems = 'center';
            typingBubble.style.padding = '15px';
            
            const dotsDiv = document.createElement('div');
            dotsDiv.className = 'typing-dots';
            
            for (let i = 0; i < 3; i++) {
                const dot = document.createElement('div');
                dot.className = 'typing-dot';
                dotsDiv.appendChild(dot);
            }
            
            typingBubble.appendChild(dotsDiv);
            typingDiv.appendChild(typingBubble);
            chatMessages.appendChild(typingDiv);
            
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function hideTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        async function sendMessage() {
            const message = chatInput.value.trim();
            if (!message) return;

            // Add user message
            addMessage(message, true);
            chatInput.value = '';
            
            // Disable send button and show typing indicator
            sendButton.disabled = true;
            showTypingIndicator();

            try {
                const response = await fetch('/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ message: message }),
                });

                const data = await response.json();
                
                hideTypingIndicator();
                
                // Handle different types of responses
                if (data.status === 'success') {
                    if (data.message_type === 'structured_outfit') {
                        // Display structured outfit recommendation
                        addOutfitRecommendation(data);
                    } else if (data.message_type === 'conversational') {
                        // Display conversational response
                        addMessage(data.response);
                    } else if (data.message_type === 'explanation') {
                        // Display explanation with special formatting
                        addMessage(data.response);
                    } else {
                        // Generic success response
                        addMessage(data.response || data.style_analysis || 'I received your request!');
                    }
                } else if (data.status === 'partial_success') {
                    // Display text response
                    addMessage(data.response || data.style_analysis || 'I received your request but had trouble formatting the response.');
                } else {
                    // Error handling
                    addMessage(data.message || 'Sorry, I encountered an error. Please try again.');
                }
            } catch (error) {
                hideTypingIndicator();
                addMessage('Sorry, I encountered a network error. Please check your connection and try again.');
                console.error('Error:', error);
            } finally {
                sendButton.disabled = false;
            }
        }

        // Event listeners
        sendButton.addEventListener('click', sendMessage);
        
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // Focus on input when page loads
        chatInput.focus();

        // Example suggestions
        const suggestions = [
            "Casual chic outfit for a coffee date under $150",
            "Professional business attire for important presentations",
            "Weekend casual wear with a budget of $100",
            "Elegant evening outfit for a special dinner",
            "Smart casual look for a job interview under $200"
        ];

        // Add click listeners for example messages
        chatInput.addEventListener('focus', function() {
            if (!this.value) {
                this.placeholder = suggestions[Math.floor(Math.random() * suggestions.length)];
            }
        });
    </script>
</body>
</html> 